<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cryptocurrency Price Graph</title>
	<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 80vh;
            margin-top: 100;
            padding-top: 100px;
        }
        canvas {
            width: 200px; /* Reduced width */
            height: 100px; /* Reduced height */
        }
    </style>
</head>
<body>
    <select id="crypto-selector" onchange="updateChart()">
        <option value="bitcoin">Bitcoin</option>
        <option value="ethereum">Ethereum</option>
        <option value="xrp">Ripple</option>
        <option value="litecoin">Litecoin</option>
        <option value="cardano">Cardano</option>
    </select>
    <canvas id="cryptoChart"></canvas>

    <script>
        const ctx = document.getElementById('cryptoChart').getContext('2d');
        let myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [], // Labels will be dates
                datasets: [{
                    label: 'Price in USD',
                    data: [],
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1,
                    fill: false
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: false
                    }
                }
            }
        });

        async function fetchCryptoData(crypto) {
            const response = await fetch(`https://api.coingecko.com/api/v3/coins/${crypto}/market_chart?vs_currency=usd&days=7&interval=daily`);
            const data = await response.json();
            //console.log(data); // Log the data to see what's being received
            return data.prices.map(price => {
                return {
                    y: price[1].toFixed(2),
                    t: new Date(price[0])
                };
            });
        }

		async function updateChart() {
			const crypto = document.getElementById('crypto-selector').value;
			//console.log(`Fetching data for: ${crypto}`);
			const cryptoData = await fetchCryptoData(crypto);
			//console.log(`Data received:`, cryptoData);

			if (cryptoData && cryptoData.length > 0) {
				myChart.data.labels = cryptoData.map(data => data.t.toLocaleDateString());
				myChart.data.datasets[0].data = cryptoData.map(data => parseFloat(data.y));
				console.log(myChart.data.datasets[0].data);
				myChart.data.datasets[0].label = `Price of ${crypto.charAt(0).toUpperCase() + crypto.slice(1)} in USD`;
				myChart.update();
			} else {
				console.log("No data to update");
			}
		}

        updateChart(); // Initial chart display
    </script>
</body>
</html>
